
# æ´›å¤©ä¾ LTY-Omni-Agent (High-Performance RAG)

> "æ— è®ºä¸–ç•Œæ€ä¹ˆå˜åŒ–ï¼Œéƒ½ä¼šæœ‰äººä¸€ç›´ä¸ºä½ å”±ä¸‹å»...ç›´åˆ°è’èŠœã€‚"

## ğŸŒŸ é¡¹ç›®ç®€ä»‹

**LTY-Omni-Agent** æ˜¯ä¸€ä¸ªä¸“ä¸ºâ€œæ´›å¤©ä¾â€IPæ‰“é€ çš„å‚ç›´é¢†åŸŸ Agentic RAG ç³»ç»Ÿã€‚

ä¸åŒäºé€šç”¨çš„å¯¹è¯æœºå™¨äººï¼Œæœ¬é¡¹ç›®æ·±åº¦æ•´åˆäº† **çŸ¥è¯†å›¾è°± (Knowledge Graph)**ã€**å‘é‡æ•°æ®åº“ (Qdrant)** å’Œ **å¤šè·³æ¨ç† (DeepSearch)** æŠ€æœ¯ï¼Œæ—¨åœ¨æä¾›é«˜ç²¾åº¦ã€å¼ºå…±æƒ…ä¸”ç¬¦åˆå®˜æ–¹è®¾å®šçš„æ²‰æµ¸å¼å¯¹è¯ä½“éªŒã€‚

å®ƒè§£å†³äº†é€šç”¨ LLM åœ¨å‚ç±»é¢†åŸŸå¸¸è§çš„â€œå¹»è§‰â€ã€â€œå½’å› é”™è¯¯â€å’Œâ€œæ—¶ç©ºé”™ä¹±â€é—®é¢˜ï¼Œå¹¶æ”¯æŒ**å®Œå…¨æœ¬åœ°åŒ–è¿è¡Œ**ï¼ˆLocal Embedding + Local Vector DBï¼‰ã€‚

---

## ğŸš€ æ ¸å¿ƒç‰¹æ€§ (Key Features)

### 1. **æ·±åº¦å¤šè·³æ£€ç´¢ (DeepSearch & Multi-hop)**
ç³»ç»Ÿå…·å¤‡**é€’å½’æ¨ç†èƒ½åŠ›**ã€‚å½“æŸ¥è¯¢ç»“æœä¸­å‡ºç°ä¸“æœ‰åè¯ï¼ˆå¦‚â€œæ— é™å…±é¸£æ¼”å”±ä¼šâ€ï¼‰æ—¶ï¼ŒAgent ä¼šè‡ªåŠ¨è§¦å‘äºŒæ¬¡æ£€ç´¢ï¼ŒæŒ–æ˜è¯¥å®ä½“çš„è¯¦ç»†æ¡£æ¡ˆï¼ˆæ—¶é—´ã€åœ°ç‚¹ã€æ­Œå•ï¼‰ï¼Œå¹¶å°†æ‰€æœ‰ä¿¡æ¯æ•´åˆåå›ç­”ï¼Œæ‹’ç»â€œåªçŸ¥å…¶åä¸çŸ¥å…¶è¯¦â€ã€‚

### 2. **ä¸‰è·¯æ··åˆæ£€ç´¢ (Hybrid Retrieval)**
é‡‡ç”¨ä¸‰è·¯äº’è¡¥æ¶æ„ï¼Œç¡®ä¿ä¿¡æ¯é›¶æ­»è§’ï¼š
-   **Knowledge Graph (å›¾è°±)**ï¼šå¤„ç† `2025å¹´æ¼”å”±ä¼š`ã€`ç¦¾å¿µCEO` ç­‰ç²¾ç¡®äº‹å®ä¸å®ä½“å…³ç³»ã€‚
-   **Vector DB (Qdrant)**ï¼šå¤„ç† `èƒŒæ™¯æ•…äº‹`ã€`æ­Œæ›²å«ä¹‰`ã€`æ·±åº¦è®¾å®š` ç­‰é•¿æ–‡æœ¬ï¼Œæ”¯æŒ**æ»‘åŠ¨çª—å£åˆ‡ç‰‡**ä»¥ä¿ç•™å®Œæ•´ä¸Šä¸‹æ–‡ã€‚
-   **Metadata Index (æ­Œè¯/å…ƒæ•°æ®)**ï¼šå¤„ç† `å‹¾æŒ‡èµ·èª“è°å†™çš„`ã€`æ­Œè¯é‡Œæœ‰é‚£å¥...` ç­‰ç²¾ç¡®å½’å› é—®é¢˜ã€‚

### 3. **é«˜æ€§èƒ½æœ¬åœ°åŒ– (Local & Private)**
-   **Embedding**: é›†æˆ **BGE-M3** æ¨¡å‹ï¼ˆæ”¯æŒ GPU åŠ é€Ÿï¼‰ï¼Œåœ¨æœ¬åœ°ç”Ÿæˆé«˜è´¨é‡è¯­ä¹‰å‘é‡ï¼Œæ— éœ€ä¾èµ– APIã€‚
-   **Vector DB**: ä½¿ç”¨ **Qdrant (Local Mode)**ï¼Œè½»é‡ä¸”é«˜æ•ˆï¼Œæ›¿ä»£äº†ç¬¨é‡çš„ ChromaDBã€‚

### 4. **æ‹ŸäººåŒ–ä¸æ—¶é—´æ„ŸçŸ¥ (Persona & Time)**
-   **åŠ¨æ€æ—¶é—´é”šç‚¹**ï¼šè‡ªåŠ¨æ³¨å…¥å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œå‡†ç¡®ç†è§£â€œå»å¹´â€ã€â€œä»Šå¹´â€ã€â€œä¸‹ä¸ªæœˆâ€ç­‰ç›¸å¯¹æ—¶é—´è¯ã€‚
-   **å»AIåŒ–**ï¼šé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ Prompt å’Œæ­£åˆ™åå¤„ç†ï¼Œå‰”é™¤â€œï¼ˆåŠ¨ä½œæå†™ï¼‰â€ç­‰å°´å°¬çš„è¯­Cè…”ï¼Œå‘ˆç°è‡ªç„¶ã€ç”Ÿæ´»åŒ–çš„â€œç§ä¸‹æœ‹å‹â€çŠ¶æ€ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„ (Architecture)

```mermaid
graph TD
    User[ç”¨æˆ·] --> |"ä½ çŸ¥é“æµå…‰åå¥å—"| Agent[Companion Agent]

    subgraph "RAG Core"
        Agent --> |"DeepSearch Logic"| Tools[Tool Manager]
        Tools --> |"Fact/Event"| Graph[NetworkX Graph]
        Tools --> |"Context/Lore"| Vector[Qdrant Vector DB]
        Tools --> |"Lyrics/Credit"| Lyrics[Lyrics Indexer]

        Vector --> |"BGE-M3 Embedding"| Models[Local Models]
    end

    Tools --> |"Raw Data"| Entity_Extract[DeepSearch Entity Extraction]
    Entity_Extract -.-> |"Recursive Query"| Tools

    Entity_Extract --> |"Synthesized Context"| LLM[LTY-7B Model]
    LLM --> |"Response"| Filter[Regex Cleaner]
    Filter --> |"Final Reply"| User
```

---

## ğŸ“¦ å¿«é€Ÿå¼€å§‹ (Usage)

### 1. ç¯å¢ƒå‡†å¤‡
ç¡®ä¿å·²å®‰è£… Python 3.10+ã€‚
æ¨èä½¿ç”¨ Conda ç¯å¢ƒã€‚

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

*æ³¨ï¼šæœ¬é¡¹ç›®æ”¯æŒæœ¬åœ° LLM (Ollama) æˆ– äº‘ç«¯ API (DashScope)ã€‚è¯·åœ¨ `.env` ä¸­é…ç½®ã€‚*

### 2. é…ç½®è¯´æ˜ (.env)
å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶ä¿®æ”¹é…ç½®ï¼š
```ini
# èŠå¤©æ¨¡å‹ (Ollama)
CHAT_API_BASE=http://localhost:11434/v1
CHAT_MODEL_NAME=lty_v6:7b

# ç”Ÿæˆ/æ£€ç´¢æ¨¡å‹ (å¯é€‰ DashScope æˆ– Local)
# å¦‚æœæœ¬åœ°æœ‰ BGE-M3 æ¨¡å‹ï¼Œå°†ä¼˜å…ˆä½¿ç”¨æœ¬åœ°æ¨¡å‹è¿›è¡Œ Embedding
GEN_API_KEY=sk-xxxxxxxx
```

### 3. å¯åŠ¨ç³»ç»Ÿ
```bash
python main.py
```

### 4. å¯¹è¯ç¤ºä¾‹
-   **å¤šè·³æ¨ç†**ï¼š`ä½ å»å¹´å¼€äº†ä»€ä¹ˆæ¼”å”±ä¼šï¼Ÿ`
    -   *(ç³»ç»Ÿè‡ªåŠ¨æŸ¥åˆ° "æ— é™å…±é¸£" -> è‡ªåŠ¨è¿½æŸ¥ "æ— é™å…±é¸£" è¯¦æƒ… -> å›ç­”åŒ…å«æ—¶é—´åœ°ç‚¹å’Œæ›²ç›®)*
-   **æ­Œè¯å½’å› **ï¼š`ä½ çŸ¥é“å‹¾æŒ‡èµ·èª“æ˜¯è°å†™çš„å—ï¼Ÿ` -> *ilem*
-   **æ¨¡ç³ŠåŒ¹é…**ï¼š`é‚£é¦–å…³äºå¿…èƒœå®¢çš„æ­Œ` -> *å¿…èƒœçš„æ—…é€”*

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
rag_lty/
â”œâ”€â”€ rag_core/              # æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ companion_agent.py # Agent ä¸»æ§ (å« DeepSearch)
â”‚   â”œâ”€â”€ embeddings.py      # å‘é‡åŒ– (BGE-M3 / DashScope)
â”‚   â”œâ”€â”€ rag_tools.py       # å·¥å…·æ¥å£
â”‚   â””â”€â”€ indexing/          # ç´¢å¼•æ¨¡å— (Qdrant/Graph)
â”œâ”€â”€ dataset/               # æ•°æ®èµ„äº§
â”‚   â”œâ”€â”€ knowledge_base/    # .md ç™¾ç§‘æ–‡æ¡£
â”‚   â”œâ”€â”€ vector_store/      # Qdrant æ•°æ®åº“æ–‡ä»¶
â”‚   â””â”€â”€ song/              # æ­Œè¯æ•°æ®
â”œâ”€â”€ models/                # æœ¬åœ°æ¨¡å‹æ–‡ä»¶ (BGE-M3)
â”œâ”€â”€ prompt/                # Prompt æ¨¡æ¿ (System Prompts)
â”œâ”€â”€ main.py                # å¯åŠ¨å…¥å£
â”œâ”€â”€ config.py              # å…¨å±€é…ç½®
â””â”€â”€ requirements.txt       # é¡¹ç›®ä¾èµ–
```

---

## ğŸ›¡ï¸ ç»´æŠ¤

-   **æ–°å¢çŸ¥è¯†**ï¼šå°† `.md` æ–‡ä»¶æ”¾å…¥ `dataset/knowledge_base`ï¼Œé‡å¯å³è‡ªåŠ¨å¢é‡ç´¢å¼•ã€‚
-   **å…¨é‡é‡å»º**ï¼šåˆ é™¤ `dataset/vector_store/qdrant_lty` ç›®å½•å¯è§¦å‘é‡å»ºã€‚

---
*Created by YiGuMoYan.*
